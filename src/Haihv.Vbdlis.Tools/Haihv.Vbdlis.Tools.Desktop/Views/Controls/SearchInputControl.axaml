<UserControl
    x:Class="Haihv.Vbdlis.Tools.Desktop.Views.Controls.SearchInputControl"
    x:Name="Root"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:conv="using:Haihv.Vbdlis.Tools.Desktop.Converters"
    xmlns:entities="using:Haihv.Vbdlis.Tools.Desktop.Entities"
    xmlns:vm="using:Haihv.Vbdlis.Tools.Desktop.ViewModels"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:DataType="vm:CungCapThongTinViewModel"
    mc:Ignorable="d">
    <UserControl.Resources>
        <conv:InverseBooleanConverter x:Key="InverseBooleanConverter" />
    </UserControl.Resources>
    <DockPanel Margin="12" LastChildFill="True">
        <!--  TÃ¬m theo Sá»‘ Giáº¥y Tá»  -->
        <Grid IsVisible="{Binding IsSoGiayToMode}" RowDefinitions="Auto,Auto,Auto,Auto,*" RowSpacing="8"
              DockPanel.Dock="Top">
            <TextBlock FontWeight="SemiBold" Text="TÃ¬m theo Sá»‘ Giáº¥y Tá»" />

            <Grid Grid.Row="1" RowDefinitions="*">
                <TextBox
                    Grid.Row="0"
                    AcceptsReturn="True"
                    Text="{Binding SearchInput, UpdateSourceTrigger=PropertyChanged}"
                    TextWrapping="Wrap"
                    MaxLines="26"
                    MinLines="26"
                    Watermark="Há»— trá»£ nháº­p nhiá»u má»¥c, má»—i má»¥c trÃªn má»™t dÃ²ng hoáº·c phÃ¢n cÃ¡ch báº±ng dáº¥u cháº¥m pháº©y ; hoáº·c dáº¥u cÃ¡ch. Náº¿u muá»‘n giá»¯ dáº¥u cÃ¡ch, Ä‘áº·t trong dáº¥u nhÃ¡y &quot;&quot;." />
            </Grid>

            <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8">
                <TextBlock Text="LÃ m má»›i dá»¯ liá»‡u:" VerticalAlignment="Center" />
                <ComboBox
                    Width="140"
                    ItemsSource="{Binding RefreshOptions}"
                    SelectedItem="{Binding SelectedRefreshOption}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding DisplayName}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>

            <Grid Grid.Row="3" ColumnDefinitions="Auto,*" ColumnSpacing="8">
                <Button
                    Content="â“˜"
                    VerticalAlignment="Center"
                    ToolTip.Tip="Há»— trá»£ nháº­p nhiá»u má»¥c, má»—i má»¥c trÃªn má»™t dÃ²ng hoáº·c phÃ¢n cÃ¡ch báº±ng dáº¥u cháº¥m pháº©y ; hoáº·c dáº¥u cÃ¡ch. Náº¿u muá»‘n giá»¯ dáº¥u cÃ¡ch, Ä‘áº·t trong dáº¥u nhÃ¡y &quot;&quot;.">
                    <Button.Flyout>
                        <Flyout>
                            <TextBlock
                                Text="Há»— trá»£ nháº­p nhiá»u má»¥c, má»—i má»¥c trÃªn má»™t dÃ²ng hoáº·c phÃ¢n cÃ¡ch báº±ng dáº¥u cháº¥m pháº©y ; hoáº·c dáº¥u cÃ¡ch. Náº¿u muá»‘n giá»¯ dáº¥u cÃ¡ch, Ä‘áº·t trong dáº¥u nhÃ¡y &quot;&quot;."
                                TextWrapping="Wrap"
                                MaxWidth="360" />
                        </Flyout>
                    </Button.Flyout>
                </Button>
                <Button
                    Grid.Column="1"
                    Command="{Binding SearchBySoGiayToCommand}"
                    Content="ðŸ” TÃ¬m kiáº¿m"
                    HorizontalAlignment="Right"
                    IsEnabled="{Binding !IsSearching}" />
            </Grid>

            <ListBox
                Grid.Row="4"
                ItemsSource="{Binding SearchHistory}"
                DoubleTapped="OnSearchHistoryDoubleTapped"
                ScrollViewer.AllowAutoHide="True"
                ScrollViewer.HorizontalScrollBarVisibility="Visible"
                SelectedItem="{Binding SelectedSearchHistory}">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="entities:SearchHistoryEntry" x:CompileBindings="False">
                        <StackPanel Spacing="2">
                            <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="6">
                                <TextBlock
                                    Text="{Binding DisplayTitle}"
                                    TextWrapping="Wrap"
                                    IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}" />
                                <TextBox
                                    Grid.Column="0"
                                    Text="{Binding EditingTitle, UpdateSourceTrigger=PropertyChanged}"
                                    Tag="{Binding}"
                                    IsVisible="{Binding IsEditing}"
                                    KeyDown="OnHistoryTitleKeyDown"
                                    LostFocus="OnHistoryTitleLostFocus" />
                                <Button
                                    Grid.Column="1"
                                    x:CompileBindings="False"
                                    Command="{Binding DataContext.StartEditHistoryCommand, ElementName=Root}"
                                    CommandParameter="{Binding}"
                                    Content="âœŽ"
                                    ToolTip.Tip="Sá»­a tiÃªu Ä‘á»" />
                                <Button
                                    Grid.Column="2"
                                    x:CompileBindings="False"
                                    Command="{Binding DataContext.SearchFromHistoryCommand, ElementName=Root}"
                                    CommandParameter="{Binding}"
                                    Content="ðŸ”"
                                    ToolTip.Tip="TÃ¬m theo lá»‹ch sá»­ nÃ y" />
                            </Grid>
                            <TextBlock
                                Text="{Binding DisplayTime}"
                                FontSize="11"
                                Foreground="Gray" />
                            <TextBlock
                                Text="{Binding DisplayDetail}"
                                FontSize="11"
                                Foreground="Gray" />
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>

        <!--  TÃ¬m theo Sá»‘ PhÃ¡t HÃ nh  -->
        <Grid IsVisible="{Binding IsSoPhatHanhMode}" 
              RowDefinitions="Auto,Auto,Auto,Auto,*" 
              DockPanel.Dock="Top"
              RowSpacing="8">
            <TextBlock FontWeight="SemiBold" Text="TÃ¬m theo Sá»‘ PhÃ¡t HÃ nh" />

            <Grid Grid.Row="1" RowDefinitions="*">
                <TextBox
                    Grid.Row="0"
                    AcceptsReturn="True"
                    Text="{Binding SearchInput, UpdateSourceTrigger=PropertyChanged}"
                    TextWrapping="Wrap"
                    MaxLines="26"
                    MinLines="26"
                    Watermark="Há»— trá»£ nháº­p nhiá»u má»¥c, má»—i má»¥c trÃªn má»™t dÃ²ng hoáº·c phÃ¢n cÃ¡ch báº±ng dáº¥u cháº¥m pháº©y ;" />
            </Grid>

            <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8">
                <TextBlock Text="LÃ m má»›i dá»¯ liá»‡u:" VerticalAlignment="Center" />
                <ComboBox
                    Width="140"
                    ItemsSource="{Binding RefreshOptions}"
                    SelectedItem="{Binding SelectedRefreshOption}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding DisplayName}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>

            <Grid Grid.Row="3" ColumnDefinitions="Auto,*" ColumnSpacing="8">
                <Button
                    Content="â“˜"
                    VerticalAlignment="Center"
                    ToolTip.Tip="Há»— trá»£ nháº­p nhiá»u má»¥c, má»—i má»¥c trÃªn má»™t dÃ²ng hoáº·c phÃ¢n cÃ¡ch báº±ng dáº¥u cháº¥m pháº©y ;">
                    <Button.Flyout>
                        <Flyout>
                            <TextBlock
                                Text="Há»— trá»£ nháº­p nhiá»u má»¥c, má»—i má»¥c trÃªn má»™t dÃ²ng hoáº·c phÃ¢n cÃ¡ch báº±ng dáº¥u cháº¥m pháº©y ;"
                                TextWrapping="Wrap"
                                MaxWidth="360" />
                        </Flyout>
                    </Button.Flyout>
                </Button>
                <Button
                    Grid.Column="1"
                    Command="{Binding SearchBySoPhatHanhCommand}"
                    Content="ðŸ” TÃ¬m kiáº¿m"
                    HorizontalAlignment="Right"
                    IsEnabled="{Binding !IsSearching}" />
            </Grid>

            <ListBox
                Grid.Row="4"
                MaxHeight="600"
                ItemsSource="{Binding SearchHistory}"
                DoubleTapped="OnSearchHistoryDoubleTapped"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                SelectedItem="{Binding SelectedSearchHistory}">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="entities:SearchHistoryEntry" x:CompileBindings="False">
                        <StackPanel Spacing="2">
                            <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="6">
                                <TextBlock
                                    Text="{Binding DisplayTitle}"
                                    TextWrapping="Wrap"
                                    IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}" />
                                <TextBox
                                    Grid.Column="0"
                                    Text="{Binding EditingTitle, UpdateSourceTrigger=PropertyChanged}"
                                    Tag="{Binding}"
                                    IsVisible="{Binding IsEditing}"
                                    KeyDown="OnHistoryTitleKeyDown"
                                    LostFocus="OnHistoryTitleLostFocus" />
                                <Button
                                    Grid.Column="1"
                                    x:CompileBindings="False"
                                    Command="{Binding DataContext.StartEditHistoryCommand, ElementName=Root}"
                                    CommandParameter="{Binding}"
                                    Content="âœŽ"
                                    ToolTip.Tip="Sá»­a tiÃªu Ä‘á»" />
                                <Button
                                    Grid.Column="2"
                                    x:CompileBindings="False"
                                    Command="{Binding DataContext.SearchFromHistoryCommand, ElementName=Root}"
                                    CommandParameter="{Binding}"
                                    Content="ðŸ”"
                                    ToolTip.Tip="TÃ¬m theo lá»‹ch sá»­ nÃ y" />
                            </Grid>
                            <TextBlock
                                Text="{Binding DisplayTime}"
                                FontSize="11"
                                Foreground="Gray" />
                            <TextBlock
                                Text="{Binding DisplayDetail}"
                                FontSize="11"
                                Foreground="Gray" />
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>

        <!--  TÃ¬m theo Thá»­a Äáº¥t (táº¡m thá»i disable)  -->
        <Grid IsVisible="{Binding IsThuaDatMode}" 
              RowDefinitions="Auto,Auto,Auto,Auto" 
              DockPanel.Dock="Top"
              RowSpacing="8">
            <TextBlock FontWeight="SemiBold" Text="TÃ¬m theo Thá»­a Äáº¥t" />
            <TextBox
                Grid.Row="1"
                AcceptsReturn="True"
                TextWrapping="Wrap"
                IsEnabled="False"
                Watermark="ChÆ°a há»— trá»£" />
            <Grid Grid.Row="2" ColumnDefinitions="Auto,*" ColumnSpacing="8">
                <Button Content="â“˜" VerticalAlignment="Center" IsEnabled="False" />
                <Button Grid.Column="1" Content="ðŸ” TÃ¬m kiáº¿m" HorizontalAlignment="Right" IsEnabled="False" />
            </Grid>
            <ListBox Grid.Row="3" IsEnabled="False" />
        </Grid>
    </DockPanel>
</UserControl>